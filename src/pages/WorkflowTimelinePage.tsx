import React, { useState } from 'react';
import { WorkflowTimeline } from '@/components/workflow/WorkflowTimeline';
import { DragDropDemo } from '@/components/workflow/DragDropDemo';
import { ArrowLeft, Zap } from 'lucide-react';
import { Button } from '@/components/ui/button';

interface TimelineItem {
  id: string;
  title: string;
  description: string;
  date: string;
  status: 'pending' | 'in-progress' | 'completed' | 'rejected';
  image?: string;
}

export default function WorkflowTimelinePage() {
  const [viewMode, setViewMode] = useState<'demo' | 'simple'>('demo');

  const handleItemUpdate = (id: string, updates: Partial<TimelineItem>) => {
    setTimelineItems(prev =>
      prev.map(item =>
        item.id === id ? { ...item, ...updates } : item
      )
    );
  };

  const handleImageUpload = async (id: string, file: File) => {
    try {
      // Simulate upload delay
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏ß‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á server)
      const imageUrl = URL.createObjectURL(file);
      
      handleItemUpdate(id, { image: imageUrl });
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
      const item = timelineItems.find(item => item.id === id);
      console.log(`‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: ${item?.title}`);
      console.log(`üìÅ ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå: ${(file.size / 1024 / 1024).toFixed(2)} MB`);
      console.log(`üñºÔ∏è ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå: ${file.type}`);
      
      // ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á server ‡∏´‡∏£‡∏∑‡∏≠ cloud storage
      // const uploadedUrl = await uploadToSupabase(file, 'workflow-images', `${id}/${file.name}`);
      // handleItemUpdate(id, { image: uploadedUrl });
      
    } catch (error) {
      console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:', error);
      throw error; // Re-throw to be handled by the component
    }
  };

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="container mx-auto px-4 py-8">
        {/* Header */}
        <div className="mb-8">
          <Button
            variant="ghost"
            className="mb-4"
            onClick={() => window.history.back()}
          >
            <ArrowLeft className="mr-2 h-4 w-4" />
            ‡∏Å‡∏•‡∏±‡∏ö
          </Button>
          
          <div className="flex justify-between items-start">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 mb-2">
                Workflow Timeline
              </h1>
              <p className="text-gray-600">
                ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
              </p>
            </div>
            
            <div className="flex gap-2">
              <Button
                variant={viewMode === 'demo' ? 'default' : 'outline'}
                onClick={() => setViewMode('demo')}
                size="sm"
              >
                <Zap className="w-4 h-4 mr-2" />
                ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏¥‡∏ï
              </Button>
              <Button
                variant={viewMode === 'simple' ? 'default' : 'outline'}
                onClick={() => setViewMode('simple')}
                size="sm"
              >
                ‡πÇ‡∏´‡∏°‡∏î‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤
              </Button>
            </div>
          </div>
        </div>

        {/* Content */}
        {viewMode === 'demo' ? (
          <DragDropDemo />
        ) : (
          <SimpleWorkflowView />
        )}
      </div>
    </div>
  );
}